@model DashboardViewModel
@{
    ViewData["Title"] = "Dashboard Home";
    Layout = "~/Views/Shared/_Layout.cshtml";
    var selectedGoal = Context.Request.Query["goal"].ToString();
}

<h1 class="headline mb-4" style="color:var(--onejax-navy);">OneJax Strategic Dashboard</h1>

<div class="container mt-4">
    <div class="card p-4"
        style="background-color:var(--onejax-white); box-shadow:0 4px 24px rgba(0,0,0,0.08); border-radius:24px; max-width:2000px;">

        <!-- Tabs for Goals -->
        <ul class="nav nav-tabs mb-4">
            <li class="nav-item">
                <a class="nav-link @(string.IsNullOrEmpty(selectedGoal) ? "active" : "")"
                    href="@Url.Action("Index", new { goal = "" })">All Goals</a>
            </li>
            @foreach (var goal in Model.StrategicGoals)
            {
                <li class="nav-item">
                    <a class="nav-link @(selectedGoal == goal.GoalName ? "active" : "")"
                        href="@Url.Action("Index", new { goal = goal.GoalName })">@goal.GoalName</a>
                </li>
            }
        </ul>

        <!-- Filters row at the top -->
        <form method="get" class="mb-4">
            <div class="d-flex flex-wrap align-items-center gap-3">
                <!-- Status Filter -->
                <select class="form-select" name="status" style="max-width:200px;">
                    <option value="" @(string.IsNullOrEmpty(Context.Request.Query["status"]) ? "selected" : "")>Status: All</option>
                    <option value="Active" @(Context.Request.Query["status"] == "Active" ? "selected" : "")>Active</option>
                    <option value="Completed" @(Context.Request.Query["status"] == "Completed" ? "selected" : "")>Completed</option>
                    <option value="Upcoming" @(Context.Request.Query["status"] == "Upcoming" ? "selected" : "")>Upcoming</option>
                </select>
                <!-- Time Filter -->
                <select class="form-select" name="time" style="max-width:200px;">
                    <option value="" @(string.IsNullOrEmpty(Context.Request.Query["time"]) ? "selected" : "")>All Time</option>
                    <option value="Monthly" @(Context.Request.Query["time"] == "Monthly" ? "selected" : "")>Monthly</option>
                    <option value="Quarterly" @(Context.Request.Query["time"] == "Quarterly" ? "selected" : "")>Quarterly</option>
                    <option value="Yearly" @(Context.Request.Query["time"] == "Yearly" ? "selected" : "")>Yearly</option>
                </select>
                <!-- Goal Filter Dropdown -->
                <select class="form-select" name="goal" style="max-width:200px;">
                    <option value="" @(string.IsNullOrEmpty(selectedGoal) ? "selected" : "")>All Goals</option>
                    @foreach (var goal in Model.StrategicGoals)
                    {
                        <option value="@goal.GoalName" @(selectedGoal == goal.GoalName ? "selected" : "")>@goal.GoalName
                        </option>
                    }
                </select>
                <button type="submit" class="btn btn-primary ms-2">Filter</button>
                <!-- Download/Export Buttons -->
                <button type="button" class="btn btn-outline-secondary ms-2">Export PDF</button>
                <button type="button" class="btn btn-outline-secondary ms-2">Export Excel</button>
            </div>
        </form>

        <!-- Dashboard cards grid: Only show projects for selected goal -->
        <div class="row">
            @foreach (var project in Model.Projects.Where(p => string.IsNullOrEmpty(selectedGoal) || p.GoalName ==
                        selectedGoal))
            {
                <div class="col-12 col-md-4 mb-4 d-flex align-items-stretch justify-content-center">
                    <div class="card dashboard-card text-center"
                        style="width:100%; max-width:260px; height:180px; background-color:var(--onejax-blue); display:flex; flex-direction:column; justify-content:center; padding:1rem;">
                        <div class="card-body d-flex flex-column justify-content-center align-items-center h-100">
                            <h4 class="headline mb-2" style="color:var(--onejax-white); font-size:1.2rem;">@project.Name
                            </h4>
                            <p class="display-6 mb-2" style="color:@project.StatusColor; font-size:1.5rem;">
                                @project.ProgressPercent%</p>
                            <span class="badge mb-3"
                                style="background-color:@project.StatusColor; font-size:1rem;">@project.Status</span>
                        </div>
                    </div>
                </div>
            }
        </div>
        <!-- Chart and Table Section ... -->
    </div>
</div>