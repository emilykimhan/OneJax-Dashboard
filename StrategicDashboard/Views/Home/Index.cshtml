@model DashboardViewModel
@using OneJaxDashboard.Models
@{
    ViewData["Title"] = "OneJax Strategic Dashboard - Enhanced";
    Layout = "~/Views/Shared/_Layout.cshtml";
    var selectedGoal = Context.Request.Query["goal"].ToString();
    var selectedStatus = Context.Request.Query["status"].ToString();
    var selectedTime = Context.Request.Query["time"].ToString();
    var selectedFiscalYear = Context.Request.Query["fiscalYear"].ToString();
    var selectedQuarter = Context.Request.Query["quarter"].ToString();
    
    // Check if we have enhanced metrics
    var hasEnhancedMetrics = Model.StrategicGoals?.Any(g => g.Metrics?.Any(m => !string.IsNullOrEmpty(m.DataSource)) == true) == true;
}

<!-- Enhanced Header Section -->
<div class="dashboard-header" style="padding: 4rem 0; margin-bottom: 3rem;">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-md-8 slide-in-left">
                <div style="margin-bottom: 1rem;">
                    <span class="badge-modern" style="background: rgba(255,255,255,0.2); color: white;">FISCAL YEAR 2025</span>
                </div>
                <h1 class="display-3 mb-4" style="font-weight: 700; color: white; text-shadow: 0 4px 20px rgba(0,0,0,0.3);">
                    Your Investment at Work
                </h1>
                <p class="lead mb-4" style="color: rgba(255,255,255,0.9); font-size: 1.5rem;">See the Revenue and the Projects</p>
                <p class="mb-3" style="color: rgba(255,255,255,0.8); font-size: 1.1rem;">The OneJax Strategic Dashboard provides comprehensive financial and project progress tracking of our strategic initiatives.</p>
                <div class="mt-4">
                    <a href="/Public/Overview" class="btn btn-outline-light btn-lg" style="border-radius: 12px; font-weight: 600; border: 2px solid rgba(255,255,255,0.3); backdrop-filter: blur(10px);">
                        ðŸŽ¯ View Goals Overview
                    </a>
                </div>
            </div>
            <div class="col-md-4 text-end slide-in-right">
                <div class="pulse-animation">
                    <img src="~/Images/OneJax Logo.png" alt="OneJax Logo" style="height: 100px; filter: drop-shadow(0 10px 30px rgba(0,0,0,0.3));">
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Comprehensive Metrics are now integrated directly into each goal tab below -->

<!-- Enhanced Introduction Section -->
<div class="container mb-5 fade-in")>
    <div class="row">
        <div class="col-12">
            <div class="floating-card" style="padding: 3rem;">
                <div class="row">
                    <div class="col-md-12">
                        <h3 style="color: var(--onejax-navy); margin-bottom: 1.5rem; font-weight: 600;">Dashboard Overview & Navigation</h3>
                        
                        <p class="mb-3" style="color: var(--onejax-text); font-size: 1.1rem; line-height: 1.6;">
                            <strong style="color: var(--onejax-navy);">Use the sorting features</strong> to focus in on goals or areas of interest. Click over to different tabs to see what is happening now, and what is planned for the near future. As projects are funded and prepared ready to implement, the progress tracking will show OneJax's goals for community engagement, organizational building, and financial stability.
                        </p>
                        
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <div style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(16, 185, 129, 0.1)); padding: 1.5rem; border-radius: 12px; border-left: 4px solid var(--onejax-blue);">
                                    <h6 style="color: var(--onejax-navy); font-weight: 600; margin-bottom: 0.5rem;">Strategic Impact</h6>
                                    <p style="color: var(--onejax-text-muted); margin-bottom: 0; font-size: 0.95rem;">OneJax's Strategic Plan provides enhanced community engagement and organizational capacity, addresses infrastructure needs, and reduces operational inefficiencies.</p>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div style="background: linear-gradient(135deg, rgba(245, 158, 11, 0.1), rgba(239, 68, 68, 0.1)); padding: 1.5rem; border-radius: 12px; border-left: 4px solid var(--onejax-orange);">
                                    <h6 style="color: var(--onejax-navy); font-weight: 600; margin-bottom: 0.5rem;">Community Reach</h6>
                                    <p style="color: var(--onejax-text-muted); margin-bottom: 0; font-size: 0.95rem;">Serving residents from Downtown to the Beaches and from Riverside to Mandarin with economic opportunity and community development.</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="text-center">
                            <p style="color: var(--onejax-text-muted); margin-bottom: 0; font-style: italic;">
                                Questions or feedback? <a href="mailto:info@onejax.org" style="color: var(--onejax-blue); text-decoration: none; font-weight: 600;">Email our team</a> | 
                                <a href="#" style="color: var(--onejax-blue); text-decoration: none;" onclick="alert('Mobile app coming soon!')">Mobile App</a>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="container mt-4">
    <div class="card p-4"
        style="background-color:var(--onejax-white); box-shadow:0 4px 24px rgba(0,0,0,0.08); border-radius:24px; max-width:2000px;">



        <!-- Modern Navigation Tabs -->
        <ul class="nav nav-tabs-modern fade-in">
            <li class="nav-item">
                <a class="nav-link @(string.IsNullOrEmpty(selectedGoal) ? "active" : "")" 
                   href="#" onclick="event.preventDefault(); switchTab('summary', this);" data-tab="summary">
                    Summary
                </a>
            </li>
            @if (Model.StrategicGoals != null)
            {
                @foreach (var goal in Model.StrategicGoals)
                {
                    <li class="nav-item">
                        <a class="nav-link @(selectedGoal == goal.Name ? "active" : "")" 
                           href="#" onclick="event.preventDefault(); switchTab('@goal.Name.Replace(" ", "_")', this);" 
                           data-tab="@goal.Name.Replace(" ", "_")">
                            @goal.Name
                        </a>
                    </li>
                }
            }
        </ul>

        <!-- Modern Dashboard Controls -->
        <div class="floating-card mb-5 fade-in">
            <div class="card-body" style="padding: 2.5rem;">
                <div class="row align-items-center mb-4">
                    <div class="col-md-8">
                        <h5 style="color: var(--onejax-navy); margin-bottom: 0.5rem; font-weight: 700;">
                            Dashboard Controls & Advanced Filters
                        </h5>
                        <p style="color: var(--onejax-text-muted); margin-bottom: 0;">Customize your view and export comprehensive reports</p>
                    </div>
                    <div class="col-md-4 text-end">
                        <span class="badge-modern" style="background: var(--gradient-secondary); color: white;">
                            ðŸ”´ Live Data
                        </span>
                    </div>
                </div>
                
                <form onsubmit="applyFilters(); return false;">
                    <div class="row g-4 align-items-end">
                        <div class="col-md-2">
                            <label class="form-label" style="color: var(--onejax-navy); font-weight: 600;">
                                Project Status
                            </label>
                            <select class="form-select" id="statusFilter" name="status" style="border-radius: 12px; border: 2px solid var(--onejax-border); padding: 12px;">
                                <option value="" selected="@(string.IsNullOrEmpty(selectedStatus))">All Statuses</option>
                                <option value="Planned" selected="@(selectedStatus == "Planned")">Planned</option>
                                <option value="Active" selected="@(selectedStatus == "Active")">In Progress</option>
                                <option value="Completed" selected="@(selectedStatus == "Completed")">Completed</option>
                                <option value="On Hold" selected="@(selectedStatus == "On Hold")">On Hold</option>
                            </select>
                        </div>
                        
                        <div class="col-md-2">
                            <label class="form-label" style="color: var(--onejax-navy); font-weight: 600;">
                                Fiscal Year
                            </label>
                            <select class="form-select" id="fiscalYearFilter" name="fiscalYear" style="border-radius: 12px; border: 2px solid var(--onejax-border); padding: 12px;">
                                <option value="" selected="@(string.IsNullOrEmpty(selectedFiscalYear))">All Years</option>
                                <option value="2024" selected="@(selectedFiscalYear == "2024")">FY 2024</option>
                                <option value="2025" selected="@(selectedFiscalYear == "2025")">FY 2025</option>
                                <option value="2026" selected="@(selectedFiscalYear == "2026")">FY 2026</option>
                                <option value="2027" selected="@(selectedFiscalYear == "2027")">FY 2027</option>
                            </select>
                        </div>

                        <div class="col-md-2">
                            <label class="form-label" style="color: var(--onejax-navy); font-weight: 600;">
                                Quarter
                            </label>
                            <select class="form-select" id="quarterFilter" name="quarter" style="border-radius: 12px; border: 2px solid var(--onejax-border); padding: 12px;">
                                <option value="" selected="@(string.IsNullOrEmpty(selectedQuarter))">All Quarters</option>
                                <option value="Q1" selected="@(selectedQuarter == "Q1")">Q1 (Jul-Sep)</option>
                                <option value="Q2" selected="@(selectedQuarter == "Q2")">Q2 (Oct-Dec)</option>
                                <option value="Q3" selected="@(selectedQuarter == "Q3")">Q3 (Jan-Mar)</option>
                                <option value="Q4" selected="@(selectedQuarter == "Q4")">Q4 (Apr-Jun)</option>
                            </select>
                        </div>

                        <div class="col-md-2">
                            <label class="form-label" style="color: var(--onejax-navy); font-weight: 600;">
                                Legacy Time Period
                            </label>
                            <select class="form-select" id="timeFilter" name="time" style="border-radius: 12px; border: 2px solid var(--onejax-border); padding: 12px;">
                                <option value="" selected="@(string.IsNullOrEmpty(selectedTime))">None</option>
                                <option value="Current Quarter" selected="@(selectedTime == "Current Quarter")">Current Quarter</option>
                                <option value="This Year" selected="@(selectedTime == "This Year")">This Calendar Year</option>
                                <option value="Q1 2025" selected="@(selectedTime == "Q1 2025")">Q1 2025</option>
                                <option value="Q2 2025" selected="@(selectedTime == "Q2 2025")">Q2 2025</option>
                                <option value="Q3 2025" selected="@(selectedTime == "Q3 2025")">Q3 2025</option>
                                <option value="Q4 2025" selected="@(selectedTime == "Q4 2025")">Q4 2025</option>
                                <option value="FY 2025" selected="@(selectedTime == "FY 2025")">FY 2025</option>
                                <option value="FY 2026" selected="@(selectedTime == "FY 2026")">FY 2026</option>
                            </select>
                        </div>

                        <div class="col-md-2">
                            <button type="submit" class="btn btn-primary-modern w-100" style="font-weight: 600;">
                                Apply Filters
                            </button>
                        </div>
                        
                        <div class="col-md-2">
                            <button type="button" class="btn btn-outline-secondary w-100" onclick="resetFilters()" style="border-radius: 12px;">
                                Reset
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- Strategic Projects Dashboard: Revenue & Progress Tracking -->
        <div class="row" id="dashboard-content">
            <!-- Summary Section -->
            <div class="col-12 mb-4 goal-section" data-goal="summary" style="@(string.IsNullOrEmpty(selectedGoal) ? "" : "display: none;")">
                <div class="card" style="background: var(--onejax-white); border: 1px solid var(--onejax-border); border-radius: 8px; border-left: 4px solid var(--onejax-blue); box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                    <div class="card-header" style="background: linear-gradient(135deg, var(--onejax-navy), var(--onejax-blue)); border-bottom: 3px solid var(--onejax-orange);">
                        <div class="row align-items-center">
                            <div class="col-md-8">
                                <h3 style="color: white; margin: 0;">
                                    Strategic Overview Summary
                                </h3>
                                <p style="color: rgba(255,255,255,0.8); margin: 0; font-size: 0.9em;">All Strategic Goals | Consolidated Progress View</p>
                            </div>
                            <div class="col-md-4 text-end">
                                @{
                                    var overallProgress = Model.StrategicGoals?.SelectMany(g => g.Metrics ?? new List<GoalMetric>()).Any() == true
                                        ? Model.StrategicGoals.SelectMany(g => g.Metrics ?? new List<GoalMetric>()).Average(m => m.ProgressPercentage) 
                                        : 0;
                                }
                                <div style="color: white;">
                                    <div style="font-size: 2rem; font-weight: 700;">@Math.Round(overallProgress, 1)%</div>
                                    <small>Total Progress</small>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card-body" style="padding: 2rem;">
                        <!-- Dashboard Analytics Header -->
                        <div class="row mb-4">
                            <div class="col-12 text-center">
                                <h4 style="color: var(--onejax-navy); font-weight: 600; margin-bottom: 0.5rem;">Dashboard Analytics</h4>
                                <p style="color: var(--onejax-text-muted); margin-bottom: 2rem;">Visual overview of your organizational progress</p>
                            </div>
                        </div>
                        
                        <!-- Goal Overview Cards Row -->
                        <div class="row mb-5">
                            @if (Model.StrategicGoals != null)
                            {
                                @foreach (var summaryGoal in Model.StrategicGoals)
                                {
                                    var goalProgress = summaryGoal.Metrics?.Any() == true ? summaryGoal.Metrics.Average(m => m.ProgressPercentage) : 0;
                                    <div class="col-md-6 col-lg-3 mb-3">
                                        <div class="card hover-card" style="background: var(--onejax-white); border: 1px solid var(--onejax-border); border-radius: 12px; cursor: pointer; transition: all 0.3s ease;" onclick="switchTab('@summaryGoal.Name.Replace(" ", "_")', null)">
                                            <div class="card-body text-center" style="padding: 1.5rem;">
                                                <h6 style="color: var(--onejax-navy); margin-bottom: 1rem; font-weight: 600;">@summaryGoal.Name</h6>
                                                <div style="font-size: 1.8rem; font-weight: 700; color: var(--onejax-navy); margin-bottom: 1rem;">@Math.Round(goalProgress, 1)%</div>
                                                <div class="progress" style="height: 8px; border-radius: 4px; background: rgba(59, 130, 246, 0.1);">
                                                    <div class="progress-bar" style="width: @Math.Min(goalProgress, 100)%; background: var(--gradient-secondary); border-radius: 4px;"></div>
                                                </div>
                                                <small style="color: var(--onejax-text-muted); margin-top: 0.5rem; display: block;">
                                                    @(summaryGoal.Metrics?.Count() ?? 0) Metrics â€¢ @(summaryGoal.Events?.Count() ?? 0) Events
                                                </small>
                                                <div style="margin-top: 0.5rem; font-size: 0.8rem; color: var(--onejax-blue);">
                                                    Click to view details â†’
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                }
                            }
                        </div>
                        
                        <!-- Dashboard Charts Row -->
                        <div class="row">
                            <!-- Strategic Goal Progress Chart -->
                            <div class="col-md-6 mb-4">
                                <div class="card" style="border-radius: 12px; border: 1px solid var(--onejax-border); box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                                    <div class="card-header" style="background: linear-gradient(135deg, var(--onejax-navy), var(--onejax-blue)); color: white; border-radius: 12px 12px 0 0;">
                                        <h6 class="mb-0">Strategic Goal Progress</h6>
                                    </div>
                                    <div class="card-body">
                                        <canvas id="progressChart" width="400" height="250"></canvas>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Data Activity Summary Chart -->
                            <div class="col-md-6 mb-4">
                                <div class="card" style="border-radius: 12px; border: 1px solid var(--onejax-border); box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                                    <div class="card-header" style="background: linear-gradient(135deg, var(--onejax-green), var(--onejax-blue)); color: white; border-radius: 12px 12px 0 0;">
                                        <h6 class="mb-0">Data Activity Summary</h6>
                                    </div>
                                    <div class="card-body">
                                        <canvas id="activityChart" width="400" height="250"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Additional Charts Row 1 -->
                        <div class="row mb-4">
                            <!-- Monthly Trends Chart -->
                            <div class="col-md-8 mb-4">
                                <div class="card" style="border-radius: 12px; border: 1px solid var(--onejax-border); box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                                    <div class="card-header" style="background: linear-gradient(135deg, var(--onejax-orange), #ea580c); color: white; border-radius: 12px 12px 0 0;">
                                        <h6 class="mb-0">ðŸ“ˆ Monthly Progress Trends</h6>
                                    </div>
                                    <div class="card-body">
                                        <canvas id="trendsChart" width="600" height="300"></canvas>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Metrics Type Distribution -->
                            <div class="col-md-4 mb-4">
                                <div class="card" style="border-radius: 12px; border: 1px solid var(--onejax-border); box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                                    <div class="card-header" style="background: linear-gradient(135deg, #8B5CF6, #7C3AED); color: white; border-radius: 12px 12px 0 0;">
                                        <h6 class="mb-0">ðŸ“Š Metrics Distribution</h6>
                                    </div>
                                    <div class="card-body">
                                        <canvas id="metricsTypeChart" width="300" height="300"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Additional Charts Row 2 -->
                        <div class="row mb-4">
                            <!-- Goal Performance Radar -->
                            <div class="col-md-6 mb-4">
                                <div class="card" style="border-radius: 12px; border: 1px solid var(--onejax-border); box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                                    <div class="card-header" style="background: linear-gradient(135deg, #10B981, #059669); color: white; border-radius: 12px 12px 0 0;">
                                        <h6 class="mb-0">ðŸŽ¯ Goal Performance Radar</h6>
                                    </div>
                                    <div class="card-body">
                                        <canvas id="radarChart" width="400" height="300"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Quick Access Cards Row -->
                        <div class="row mb-4">
                            <div class="col-12 mb-3">
                                <h5 style="color: var(--onejax-navy); font-weight: 600; margin-bottom: 1rem;">
                                    <i class="fas fa-rocket"></i> Quick Access
                                </h5>
                            </div>
                            
                            
                            <!-- Website Traffic Card -->
                            <div class="col-md-4 mb-3">
                                <div class="card hover-card metric-card-creative" style="border-radius: 12px; border: 1px solid var(--onejax-border); cursor: pointer; transition: all 0.3s ease;" onclick="window.location.href='/WebsiteTraffic'">
                                    <div class="card-body text-center" style="padding: 1.5rem;">
                                        <div class="mb-3">
                                            <i class="fas fa-chart-line" style="font-size: 2.5rem; color: var(--onejax-green);"></i>
                                        </div>
                                        <h6 class="card-title" style="color: var(--onejax-navy); font-weight: 600; margin-bottom: 0.5rem;">Website Traffic</h6>
                                        <p class="card-text text-muted" style="font-size: 0.9rem; margin-bottom: 1rem;">Monitor website analytics and engagement</p>
                                        <div class="d-flex justify-content-center align-items-center">
                                            <span class="badge" style="background: linear-gradient(135deg, var(--onejax-green), var(--onejax-orange)); color: white; font-size: 0.75rem;">
                                                @Model.Summary.TotalWebsiteTrafficEntries Entries
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- OneJax Website Card -->
                            <div class="col-md-4 mb-3">
                                <div class="card hover-card metric-card-creative" style="border-radius: 12px; border: 1px solid var(--onejax-border); cursor: pointer; transition: all 0.3s ease;" onclick="window.open('https://onejax.org', '_blank')">
                                    <div class="card-body text-center" style="padding: 1.5rem;">
                                        <div class="mb-3">
                                            <i class="fas fa-globe" style="font-size: 2.5rem; color: var(--onejax-orange);"></i>
                                        </div>
                                        <h6 class="card-title" style="color: var(--onejax-navy); font-weight: 600; margin-bottom: 0.5rem;">OneJax Website</h6>
                                        <p class="card-text text-muted" style="font-size: 0.9rem; margin-bottom: 1rem;">Visit our main organization website</p>
                                        <div class="d-flex justify-content-center align-items-center">
                                            <span class="badge" style="background: linear-gradient(135deg, var(--onejax-orange), var(--onejax-navy)); color: white; font-size: 0.75rem;">
                                                <i class="fas fa-external-link-alt"></i> Visit Site
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Export Button Row -->
                        <div class="row mt-3">
                            <div class="col-12 text-center">
                                <button onclick="exportDashboard()" class="btn btn-outline-primary">
                                    <i class="fas fa-download"></i> Export Dashboard Data
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            @if (Model.StrategicGoals != null)
            {
                @foreach (var goal in Model.StrategicGoals)
                {
                    @* Municipal dashboard styling *@
                    var isSelectedGoal = !string.IsNullOrEmpty(selectedGoal) && goal.Name == selectedGoal;
                    var shouldShow = !string.IsNullOrEmpty(selectedGoal) && goal.Name == selectedGoal;
                
                <div class="col-12 mb-4 goal-section" 
                     data-goal="@goal.Name.Replace(" ", "_")" 
                     style="@(shouldShow ? "" : "display: none;")">
                    <div class="card" style="background: var(--onejax-white); border: 1px solid var(--onejax-border); border-radius: 8px; @(isSelectedGoal ? "border-left: 6px solid var(--onejax-orange);" : "border-left: 4px solid var(--onejax-blue);") box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                        <div class="card-header" style="background: linear-gradient(135deg, var(--onejax-navy), var(--onejax-blue)); border-bottom: 3px solid var(--onejax-orange);">
                            <div class="row align-items-center">
                                <div class="col-md-8">
                                    <h3 style="color: white; margin: 0;">
                                        @goal.Name @(isSelectedGoal ? "â˜…" : "")
                                    </h3>
                                    <p style="color: rgba(255,255,255,0.8); margin: 0; font-size: 0.9em;">Strategic Initiative | Investment Tracking & Progress</p>
                                </div>
                                <div class="col-md-4 text-end">
                                    @{
                                        var goalMetrics = goal.Metrics ?? new List<GoalMetric>();
                                        var goalProgress = goalMetrics.Any() ? goalMetrics.Average(m => m.ProgressPercentage) : 0;
                                    }
                                    <div style="color: white;">
                                        <div style="font-size: 2rem; font-weight: 700;">@Math.Round(goalProgress, 1)%</div>
                                        <small>Overall Progress</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card-body" style="padding: 2rem;">
                            <div class="row mb-4">
                                <div class="col-md-12">
                                    <div class="progress" style="height: 12px; border-radius: 6px;">
                                        <div class="progress-bar" style="width: @Math.Min(goalProgress, 100)%; background: linear-gradient(90deg, var(--onejax-blue), var(--onejax-green)); border-radius: 6px;" role="progressbar"></div>
                                    </div>
                                    <div class="d-flex justify-content-between mt-2">
                                        <small style="color: var(--onejax-text-muted);">Project Start</small>
                                        <small style="color: var(--onejax-navy); font-weight: 600;">@Math.Round(goalProgress, 1)% Complete</small>
                                        <small style="color: var(--onejax-text-muted);">Target Completion</small>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Metrics Section -->
                            @if (goal.Metrics != null && goal.Metrics.Any())
                            {
                                <div class="mb-4">
                                    <h5 style="color:var(--onejax-white); margin-bottom:15px;">Key Metrics</h5>
                                    <div class="row">
                                        @foreach (var metric in goal.Metrics)
                                        {
                                            @* Different visual styles based on metric type and goal *@
                                            @if (goal.Name == "Community Engagement" && metric.Name.Contains("Satisfaction"))
                                            {
                                                <!-- Professional Satisfaction Card -->
                                                <div class="col-md-4 mb-3">
                                                    <div class="card" style="background:var(--onejax-white); border:1px solid #e5e7eb; border-radius:8px;">
                                                        <div class="card-body">
                                                            <h6 class="card-title" style="color:var(--onejax-navy); font-weight:600;">@metric.Name</h6>
                                                            <div class="d-flex justify-content-between align-items-center mb-3">
                                                                <div>
                                                                    <div class="h3 mb-0" style="color:var(--onejax-navy);">@metric.CurrentValue%</div>
                                                                    <small class="text-muted">Target: @metric.Target%</small>
                                                                </div>
                                                                @if (metric.CurrentValue >= Convert.ToDecimal(metric.Target))
                                                                {
                                                                    <span class="badge bg-success">Target Met</span>
                                                                }
                                                                else
                                                                {
                                                                    <span class="badge" style="background-color:var(--onejax-orange); color:white;">In Progress</span>
                                                                }
                                                            </div>
                                                            <div class="progress" style="height:6px;">
                                                                <div class="progress-bar" style="width:@(Math.Min(metric.ProgressPercentage, 100))%; background-color:var(--onejax-blue);" role="progressbar"></div>
                                                            </div>
                                                            <small class="text-muted mt-1">@Math.Round(metric.ProgressPercentage, 1)% of target</small>
                                                        </div>
                                                    </div>
                                                </div>
                                            }
                                            else if (goal.Name == "Community Engagement" && (metric.Name.Contains("Growth") || metric.Name.Contains("Expansion")))
                                            {
                                                <!-- Professional Growth Card -->
                                                <div class="col-md-6 mb-3">
                                                    <div class="card" style="background:var(--onejax-white); border:1px solid #e5e7eb; border-radius:8px;">
                                                        <div class="card-body">
                                                            <h6 class="card-title" style="color:var(--onejax-navy); font-weight:600;">@metric.Name</h6>
                                                            <div class="row align-items-center mb-3">
                                                                <div class="col-6">
                                                                    <div class="h3 mb-0" style="color:var(--onejax-navy);">@metric.CurrentValue</div>
                                                                    <small class="text-muted">Current @metric.Unit</small>
                                                                </div>
                                                                <div class="col-6 text-end">
                                                                    <div style="color:var(--onejax-navy);">Target: @metric.Target</div>
                                                                    <span class="badge" style="background-color:var(--onejax-blue); color:white;">@Math.Round(metric.ProgressPercentage, 1)%</span>
                                                                </div>
                                                            </div>
                                                            @if (metric.Q1Value > 0)
                                                            {
                                                                <div class="mb-2" style="font-size:0.9em; color:#6b7280;">
                                                                    <strong>Q1 Progress:</strong> @metric.Q1Value.ToString("N0")
                                                                </div>
                                                            }
                                                            <div class="progress" style="height:6px;">
                                                                <div class="progress-bar" style="width:@(Math.Min(metric.ProgressPercentage, 100))%; background-color:var(--onejax-blue);" role="progressbar"></div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            }
                                            else if (goal.Name == "Community Engagement" && metric.Name.Contains("Events"))
                                            {
                                                <!-- Professional Event Counter -->
                                                <div class="col-md-4 mb-3">
                                                    <div class="card" style="background:var(--onejax-white); border:1px solid #e5e7eb; border-radius:8px;">
                                                        <div class="card-body text-center">
                                                            <h6 class="card-title" style="color:var(--onejax-navy); font-weight:600;">@metric.Name</h6>
                                                            <div class="h2 mb-0" style="color:var(--onejax-navy);">@metric.CurrentValue</div>
                                                            <small class="text-muted">Events Hosted</small>
                                                            <div class="mt-3">
                                                                <small class="text-muted">Target: @metric.Target</small>
                                                            </div>
                                                            @if (metric.CurrentValue >= Convert.ToDecimal(metric.Target))
                                                            {
                                                                <div class="mt-2">
                                                                    <span class="badge bg-success">Target Exceeded</span>
                                                                </div>
                                                            }
                                                            else
                                                            {
                                                                <div class="progress mt-2" style="height:4px;">
                                                                    <div class="progress-bar" style="width:@(Math.Min(metric.ProgressPercentage, 100))%; background-color:var(--onejax-blue);" role="progressbar"></div>
                                                                </div>
                                                            }
                                                        </div>
                                                    </div>
                                                </div>
                                            }
                                            else if (goal.Name == "Community Engagement" && metric.Name.Contains("Skills"))
                                            {
                                                <!-- Professional Skills Achievement -->
                                                <div class="col-md-6 mb-3">
                                                    <div class="card" style="background:var(--onejax-white); border:1px solid #e5e7eb; border-radius:8px;">
                                                        <div class="card-body">
                                                            <h6 class="card-title" style="color:var(--onejax-navy); font-weight:600;">Skills Assessment Improvement</h6>
                                                            <div class="row align-items-center mb-3">
                                                                <div class="col-6">
                                                                    <div class="h2 mb-0" style="color:var(--onejax-navy);">@metric.CurrentValue%</div>
                                                                    <small class="text-muted">Current Achievement</small>
                                                                </div>
                                                                <div class="col-6 text-end">
                                                                    <div style="color:var(--onejax-navy);">Target: @metric.Target%</div>
                                                                    <span class="badge bg-success">Outstanding Performance</span>
                                                                </div>
                                                            </div>
                                                            <div class="progress" style="height:8px;">
                                                                <div class="progress-bar bg-success" style="width:100%;" role="progressbar"></div>
                                                            </div>
                                                            <small class="text-muted mt-2 d-block">Resilience & Communication Skills</small>
                                                        </div>
                                                    </div>
                                                </div>
                                            }
                                            else if (metric.Name.Contains("Earned Media"))
                                            {
                                                <!-- Professional Media Card -->
                                                <div class="col-md-4 mb-3">
                                                    <div class="card" style="background:var(--onejax-white); border:1px solid #e5e7eb; border-radius:8px;">
                                                        <div class="card-body text-center">
                                                            <h6 class="card-title" style="color:var(--onejax-navy); font-weight:600;">@metric.Name</h6>
                                                            <div class="h2 mb-0" style="color:var(--onejax-navy);">@metric.CurrentValue</div>
                                                            <small class="text-muted">/ @metric.Target @metric.Unit</small>
                                                            <div class="mt-3">
                                                                <div class="progress" style="height:6px;">
                                                                    <div class="progress-bar" style="width:@(Math.Min(metric.ProgressPercentage, 100))%; background-color:var(--onejax-blue);" role="progressbar"></div>
                                                                </div>
                                                                <small class="text-muted mt-1 d-block">@Math.Round(metric.ProgressPercentage, 1)% Complete</small>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            }
                                            else if (metric.Name.Contains("Website Traffic"))
                                            {
                                                // Skip Website Traffic metrics since we have the quarterly chart
                                            }
                                            else if (metric.Name.Contains("Community Perception"))
                                            {
                                                <!-- Professional Trust Rating Card -->
                                                <div class="col-md-4 mb-3">
                                                    <div class="card" style="background:var(--onejax-white); border:1px solid #e5e7eb; border-radius:8px;">
                                                        <div class="card-body text-center">
                                                            <h6 class="card-title" style="color:var(--onejax-navy); font-weight:600;">Community Trust Rating</h6>
                                                            <div class="h2 mb-2" style="color:var(--onejax-navy);">@metric.CurrentValue%</div>
                                                            <small class="text-muted">Trust Rating Score</small>
                                                            @if (metric.CurrentValue >= Convert.ToDecimal(metric.Target))
                                                            {
                                                                <div class="mt-3">
                                                                    <span class="badge bg-success">Target Achieved</span>
                                                                </div>
                                                            }
                                                            else
                                                            {
                                                                <div class="mt-3">
                                                                    <small class="text-muted">Target: @metric.Target%</small>
                                                                    <div class="progress mt-2" style="height:6px;">
                                                                        <div class="progress-bar" style="width:@(Math.Min(metric.ProgressPercentage, 100))%; background-color:var(--onejax-blue);" role="progressbar"></div>
                                                                    </div>
                                                                </div>
                                                            }
                                                        </div>
                                                    </div>
                                                </div>
                                            }
                                            else if (metric.Name.Contains("Media Placements") || 
                                                     metric.Name.Contains("Key Plan Milestones") || 
                                                     metric.Name.Contains("Content calendar") ||
                                                     metric.Name.Contains("brand messaging"))
                                            {
                                                // Skip these unwanted metrics - they don't have proper forms
                                            }
                                            else
                                            {
                                                <!-- Default Progress Bar Style -->
                                                <div class="col-md-6 mb-3">
                                                    <div class="card" style="background:var(--onejax-white); border-radius:12px; border-left: 5px solid var(--onejax-orange);">
                                                        <div class="card-body">
                                                            <h6 class="card-title" style="color:var(--onejax-navy);">@metric.Name</h6>
                                                            <p class="card-text" style="color:var(--onejax-navy); font-size:0.9em;">@metric.Description</p>
                                                            
                                                            <div class="d-flex justify-content-between align-items-center mb-2">
                                                                <span style="color:var(--onejax-navy);"><strong>Progress:</strong></span>
                                                                <span class="badge bg-primary">@metric.CurrentValue @metric.Unit / @metric.Target @metric.Unit</span>
                                                            </div>
                                                            
                                            <div class="progress mb-2" style="height: 12px; border-radius:6px;">
                                                <div class="progress-bar" role="progressbar" 
                                                     style="width: @(metric.ProgressPercentage > 0 ? Math.Max(metric.ProgressPercentage, 2) : 0)%; background-color: var(--onejax-blue);"
                                                     aria-valuenow="@metric.ProgressPercentage" aria-valuemin="0" aria-valuemax="100"></div>
                                            </div>                                                            <small style="color:var(--onejax-navy);">
                                                                <strong>Target:</strong> @metric.TargetDate.ToString("MMM yyyy") | 
                                                                <span class="badge @(metric.Status == "Active" ? "bg-success" : "bg-secondary")">@metric.Status</span>
                                                            </small>
                                                        </div>
                                                    </div>
                                                </div>
                                            }
                                        }
                                    </div>
                                </div>
                            }
                            
                            <!-- Quarterly Performance Overview Chart -->
                            @if (goal.Name.Contains("Identity") || goal.Name.Contains("Value"))
                            {
                                <div class="mb-4">
                                    <div class="card" style="border-radius: 12px; border: 1px solid var(--onejax-border); box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                                        <div class="card-header" style="background: linear-gradient(135deg, var(--onejax-navy), var(--onejax-blue)); color: white; border-radius: 12px 12px 0 0;">
                                            <h6 class="mb-0">ðŸ“… Quarterly Performance Overview</h6>
                                        </div>
                                        <div class="card-body">
                                            <canvas id="quarterlyChart" width="800" height="280" style="max-height: 280px;"></canvas>
                                        </div>
                                    </div>
                                </div>
                            }

                            <!-- Financial Progress Chart - Only for Financial Sustainability -->
                            @if (goal.Name.Contains("Financial") || goal.Name.Contains("Sustainability"))
                            {
                                <div class="mb-4">
                                    <div class="card" style="border-radius: 12px; border: 1px solid var(--onejax-border); box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                                        <div class="card-header" style="background: linear-gradient(135deg, #10b981, #059669); color: white; border-radius: 12px 12px 0 0;">
                                            <h6 class="mb-0">ðŸ’° Financial Progress Tracking</h6>
                                        </div>
                                        <div class="card-body" style="padding: 1rem;">
                                            <div style="width: 400px; height: 200px; position: relative; margin: 0 auto;">
                                                <canvas id="financialChart" width="400" height="200"></canvas>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            }

                            
                            <!-- Public Summary Section - For Non-Authenticated Users -->
                            @if (!User.Identity.IsAuthenticated)
                            {
                                <div class="mb-4">
                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                        <h5 style="color:var(--onejax-navy); margin-bottom:0;">ðŸŒŸ Goal Progress Summary</h5>
                                        <small class="text-muted">
                                            <i class="fas fa-chart-bar"></i> Public progress overview
                                        </small>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6 col-lg-6 mb-3">
                                            <div class="card" style="border-radius: 12px; border: 1px solid var(--onejax-border); transition: all 0.2s ease;">
                                                <div class="card-body text-center" style="padding: 1.5rem;">
                                                    <h6 style="color: var(--onejax-navy); margin-bottom: 1rem; font-weight: 600;">Overall Progress</h6>
                                                    @{
                                                        var currentGoalProgress = goal.Metrics?.Any() == true ? goal.Metrics.Average(m => m.ProgressPercentage) : 0;
                                                    }
                                                    <div style="font-size: 2rem; font-weight: 700; color: var(--onejax-navy); margin-bottom: 1rem;">@Math.Round(currentGoalProgress, 1)%</div>
                                                    <div class="progress" style="height: 8px; border-radius: 4px; background: rgba(59, 130, 246, 0.1);">
                                                        <div class="progress-bar" style="width: @Math.Min(currentGoalProgress, 100)%; background: var(--gradient-secondary); border-radius: 4px;"></div>
                                                    </div>
                                                    <small class="text-muted mt-2 d-block">Strategic Initiative Progress</small>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6 col-lg-6 mb-3">
                                            <div class="card" style="border-radius: 12px; border: 1px solid var(--onejax-border); transition: all 0.2s ease;">
                                                <div class="card-body text-center" style="padding: 1.5rem;">
                                                    <h6 style="color: var(--onejax-navy); margin-bottom: 1rem; font-weight: 600;">
                                                        <i class="fas fa-calendar-check"></i> Strategic Events
                                                    </h6>
                                                    <div style="font-size: 2rem; font-weight: 700; color: var(--onejax-navy); margin-bottom: 1rem;">@(goal.Events?.Count() ?? 0)</div>
                                                    @{
                                                        var upcomingCount = goal.Events?.Count(e => e.Status == "Planned" || e.Status == "In Progress") ?? 0;
                                                        var completedCount = goal.Events?.Count(e => e.Status == "Completed") ?? 0;
                                                    }
                                                    @if (goal.Events != null && goal.Events.Any())
                                                    {
                                                        <div style="color: var(--onejax-text-muted); font-size: 0.9rem;">
                                                            @upcomingCount upcoming â€¢ @completedCount completed
                                                        </div>
                                                        @if (upcomingCount > 0)
                                                        {
                                                            <div style="margin-top: 0.5rem;">
                                                                <span class="badge" style="background: var(--gradient-secondary); color: white; font-size: 0.75rem;">
                                                                    Next: @(goal.Events.Where(e => e.DueDate.HasValue && e.DueDate > DateTime.Now).OrderBy(e => e.DueDate).FirstOrDefault()?.DueDate?.ToString("MMM dd") ?? "TBD")
                                                                </span>
                                                            </div>
                                                        }
                                                    }
                                                    else
                                                    {
                                                        <div style="color: var(--onejax-text-muted); font-size: 0.9rem;">No events scheduled yet</div>
                                                    }
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            }
                            
                            <!-- Events Section - Enhanced Display -->
                            @if (goal.Events != null && goal.Events.Any())
                            {
                                <div class="mb-4">
                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                        <h5 style="color:var(--onejax-navy); margin-bottom:0; font-weight: 600;">
                                            <i class="fas fa-calendar-check"></i> Strategic Events & Activities
                                        </h5>
                                        <span class="badge" style="background: var(--gradient-secondary); color: white;">
                                            @goal.Events.Count() Total Events
                                        </span>
                                    </div>
                                    
                                    <!-- Event Status Summary -->
                                    @{
                                        var upcomingEvents = goal.Events.Count(e => e.Status == "Planned" || e.Status == "In Progress");
                                        var completedEvents = goal.Events.Count(e => e.Status == "Completed");
                                        var activeEvents = goal.Events.Count(e => e.Status == "Active" || e.Status == "In Progress");
                                    }
                                    
                                    <div class="row mb-3">
                                        <div class="col-md-4">
                                            <div class="text-center p-2" style="background: rgba(59, 130, 246, 0.1); border-radius: 8px;">
                                                <div style="font-size: 1.5rem; font-weight: 700; color: var(--onejax-blue);">@upcomingEvents</div>
                                                <small style="color: var(--onejax-text-muted);">Upcoming</small>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="text-center p-2" style="background: rgba(16, 185, 129, 0.1); border-radius: 8px;">
                                                <div style="font-size: 1.5rem; font-weight: 700; color: var(--onejax-green);">@activeEvents</div>
                                                <small style="color: var(--onejax-text-muted);">Active</small>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="text-center p-2" style="background: rgba(34, 197, 94, 0.1); border-radius: 8px;">
                                                <div style="font-size: 1.5rem; font-weight: 700; color: #22c55e;">@completedEvents</div>
                                                <small style="color: var(--onejax-text-muted);">Completed</small>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Event Cards -->
                                    <div class="row">
                                        @foreach (var eventItem in goal.Events
                                            .Where(e => (string.IsNullOrEmpty(selectedStatus) || e.Status == selectedStatus))
                                            .OrderBy(e => e.DueDate ?? DateTime.MaxValue))
                                        {
                                            <div class="col-md-6 col-lg-4 mb-3">
                                                <div class="card event-card" 
                                                     style="background-color:var(--onejax-white); border-radius:12px; border: 1px solid var(--onejax-border); transition: all 0.3s ease; cursor: pointer;"
                                                     data-status="@eventItem.Status"
                                                     data-date="@eventItem.DueDate?.ToString("yyyy-MM-dd")"
                                                     data-quarter="@((eventItem.DueDate?.Month - 1) / 3 + 1)"
                                                     data-year="@eventItem.DueDate?.Year"
                                                     onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.15)';"
                                                     onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.1)';">
                                                    
                                                    <!-- Event Header -->
                                                    <div class="card-header" style="background: linear-gradient(135deg, @(GetEventHeaderColor(eventItem.Status)), @(GetEventHeaderColorSecondary(eventItem.Status))); color: white; border-radius: 12px 12px 0 0; border: none;">
                                                        <div class="d-flex justify-content-between align-items-center">
                                                            <div>
                                                                <h6 style="margin: 0; font-weight: 600;">@eventItem.Title</h6>
                                                                <small style="opacity: 0.9;">@eventItem.Type Event</small>
                                                            </div>
                                                            <span class="badge" style="background: rgba(255,255,255,0.2);">
                                                                @eventItem.Status
                                                            </span>
                                                        </div>
                                                    </div>
                                                    
                                                    <!-- Event Body -->
                                                    <div class="card-body" style="padding: 1rem;">
                                                        <div class="event-details">
                                                            <div class="mb-2">
                                                                <i class="fas fa-calendar" style="color: var(--onejax-blue); width: 16px;"></i>
                                                                <strong>Date:</strong> 
                                                                <span style="color: var(--onejax-navy);">
                                                                    @(eventItem.DueDate?.ToString("MMM dd, yyyy") ?? eventItem.StartDate?.ToString("MMM dd, yyyy") ?? "TBD")
                                                                </span>
                                                            </div>
                                                            
                                                            <div class="mb-2">
                                                                <i class="fas fa-map-marker-alt" style="color: var(--onejax-orange); width: 16px;"></i>
                                                                <strong>Location:</strong> 
                                                                <span style="color: var(--onejax-navy);">@(eventItem.Location ?? "TBD")</span>
                                                            </div>
                                                            
                                                            @if (eventItem.Attendees > 0)
                                                            {
                                                                <div class="mb-2">
                                                                    <i class="fas fa-users" style="color: var(--onejax-green); width: 16px;"></i>
                                                                    <strong>Expected:</strong> 
                                                                    <span style="color: var(--onejax-navy);">@eventItem.Attendees attendees</span>
                                                                </div>
                                                            }
                                                            
                                                            @if (!string.IsNullOrEmpty(eventItem.Description))
                                                            {
                                                                <div class="mb-3">
                                                                    <small style="color: var(--onejax-text-muted);">
                                                                        @(eventItem.Description.Length > 80 ? eventItem.Description.Substring(0, 80) + "..." : eventItem.Description)
                                                                    </small>
                                                                </div>
                                                            }
                                                            
                                                            @if (!string.IsNullOrEmpty(eventItem.Notes))
                                                            {
                                                                <div class="mb-3">
                                                                    <small style="color: var(--onejax-text-muted); font-style: italic;">
                                                                        ðŸ“ @(eventItem.Notes.Length > 60 ? eventItem.Notes.Substring(0, 60) + "..." : eventItem.Notes)
                                                                    </small>
                                                                </div>
                                                            }
                                                        </div>
                                                        
                                                        <!-- Action Buttons -->
                                                        <div class="d-flex justify-content-between align-items-center">
                                                            @if (User?.Identity?.IsAuthenticated ?? false)
                                                            {
                                                                <a href="/Strategy/ViewEvents" 
                                                                   class="btn btn-sm btn-outline-primary" 
                                                                   style="border-radius: 8px;"
                                                                   target="_blank">
                                                                    <i class="fas fa-cog"></i> Manage
                                                                </a>
                                                            }
                                                            else
                                                            {
                                                                <div></div>
                                                            }
                                                            
                                                            @if (eventItem.DueDate.HasValue)
                                                            {
                                                                var daysUntil = (eventItem.DueDate.Value - DateTime.Now).Days;
                                                                @if (daysUntil >= 0)
                                                                {
                                                                    <small style="color: var(--onejax-blue); font-weight: 600;">
                                                                        @if (daysUntil == 0)
                                                                        {
                                                                            <span>ðŸ“… Today!</span>
                                                                        }
                                                                        else if (daysUntil == 1)
                                                                        {
                                                                            <span>ðŸ“… Tomorrow</span>
                                                                        }
                                                                        else if (daysUntil <= 7)
                                                                        {
                                                                            <span style="color: var(--onejax-orange);">ðŸ“… In @daysUntil days</span>
                                                                        }
                                                                        else
                                                                        {
                                                                            <span>ðŸ“… In @daysUntil days</span>
                                                                        }
                                                                    </small>
                                                                }
                                                                else
                                                                {
                                                                    <small style="color: #ef4444;">
                                                                        @if (eventItem.Status != "Completed")
                                                                        {
                                                                            <span>âš ï¸ @(-daysUntil) days overdue</span>
                                                                        }
                                                                        else
                                                                        {
                                                                            <span style="color: var(--onejax-green);">âœ… Completed</span>
                                                                        }
                                                                    </small>
                                                                }
                                                            }
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        }
                                    </div>
                                    
                                    <!-- Quick Action Buttons -->
                                    <div class="text-center mt-3">
                                        @if (User?.Identity?.IsAuthenticated ?? false)
                                        {
                                            <a href="/Strategy/Index?goalId=@goal.Id" class="btn btn-outline-primary btn-sm me-2">
                                                <i class="fas fa-plus"></i> Add New Event
                                            </a>
                                        }
                                        <a href="/Strategy/ViewEvents" class="btn btn-outline-secondary btn-sm">
                                            <i class="fas fa-calendar"></i> View All Events
                                        </a>
                                    </div>
                                </div>
                            }
                            else
                            {
                                <!-- No Events State -->
                                <div class="mb-4">
                                    <div class="text-center py-4" style="background: rgba(59, 130, 246, 0.05); border-radius: 12px; border: 2px dashed var(--onejax-border);">
                                        <i class="fas fa-calendar-plus" style="font-size: 3rem; color: var(--onejax-blue); margin-bottom: 1rem;"></i>
                                        <h6 style="color: var(--onejax-navy); margin-bottom: 0.5rem;">No Events Yet for @goal.Name</h6>
                                        <p style="color: var(--onejax-text-muted); margin-bottom: 1rem;">Start planning your strategic initiatives and events.</p>
                                        @if (User?.Identity?.IsAuthenticated ?? false)
                                        {
                                            <a href="/Strategy/Index?goalId=@goal.Id" class="btn btn-primary btn-sm">
                                                <i class="fas fa-plus"></i> Create First Event
                                            </a>
                                        }
                                        else
                                        {
                                            <a href="/Strategy/ViewEvents" class="btn btn-outline-primary btn-sm">
                                                <i class="fas fa-eye"></i> View Public Events
                                            </a>
                                        }
                                    </div>
                                </div>
                            }
                            
                            @if ((goal.Events == null || !goal.Events.Any()) && (goal.Metrics == null || !goal.Metrics.Any()))
                            {
                                <p style="color:var(--onejax-white);">No data in this category yet.</p>
                                <p style="color:var(--onejax-white); font-size:0.9em;">Data will be managed through the Events tab above.</p>
                            }
                        </div>
                    </div>
                </div>
                }
            }
        </div>

        <!-- Enhanced Financial & Project Summary Dashboard -->
        <div class="row mt-6 fade-in">
            <div class="col-12 mb-4 text-center">
                <h2 style="color: var(--onejax-navy); font-weight: 700; margin-bottom: 1rem;">
                    Investment Summary & Project Overview
                </h2>
                <p style="color: var(--onejax-text-muted); font-size: 1.1rem;">Real-time tracking of strategic initiatives and financial performance</p>
            </div>
        </div>
        
        <div class="row g-4">
            <!-- Total Investment -->
            <div class="col-md-3 slide-in-left">
                <div class="stat-card-modern" style="background: var(--gradient-primary);">
                    <div style="color: white;">
                        <div style="font-size: 0.9rem; margin-bottom: 1.5rem; opacity: 0.9;">TOTAL INVESTMENT</div>
                        <h2 style="color: white; margin-bottom: 1rem; font-weight: 700;">--</h2>
                        <small style="opacity: 0.8;">No financial data entered</small>
                        <div class="progress-modern mt-3" style="background: rgba(255,255,255,0.2);">
                            <div class="progress-bar" style="width: 0%; background: rgba(255,255,255,0.8);"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            @{
                var allEvents = Model.StrategicGoals?.SelectMany(g => g.Events ?? new List<Event>()) ?? new List<Event>();
                var totalEventsCount = allEvents.Count();
                var activeEventsCount = allEvents.Count(e => e.Status == "Active");
                var completedEventsCount = allEvents.Count(e => e.Status == "Completed");
                var activePercentage = totalEventsCount > 0 ? (activeEventsCount * 100.0 / totalEventsCount) : 0;
                var completedPercentage = totalEventsCount > 0 ? (completedEventsCount * 100.0 / totalEventsCount) : 0;
            }
            
            <!-- Active Projects -->
            <div class="col-md-3 slide-in-left" style="animation-delay: 0.1s;">
                <div class="stat-card-modern" style="background: var(--gradient-secondary);">
                    <div style="color: white;">
                        <div style="font-size: 0.9rem; margin-bottom: 1.5rem; opacity: 0.9;">ACTIVE PROJECTS</div>
                        <h2 style="color: white; margin-bottom: 1rem; font-weight: 700;">@activeEventsCount</h2>
                        <small style="opacity: 0.8;">Currently In Progress</small>
                        <div class="progress-modern mt-3" style="background: rgba(255,255,255,0.2);">
                            <div class="progress-bar" style="width: @activePercentage%; background: rgba(255,255,255,0.8);"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Completed Projects -->
            <div class="col-md-3 slide-in-right" style="animation-delay: 0.2s;">
                <div class="stat-card-modern" style="background: linear-gradient(135deg, var(--onejax-green), #059669);">
                    <div style="color: white;">
                        <div style="font-size: 0.9rem; margin-bottom: 1.5rem; opacity: 0.9;">COMPLETED</div>
                        <h2 style="color: white; margin-bottom: 1rem; font-weight: 700;">@completedEventsCount</h2>
                        <small style="opacity: 0.8;">Successfully Delivered</small>
                        <div class="progress-modern mt-3" style="background: rgba(255,255,255,0.2);">
                            <div class="progress-bar" style="width: @completedPercentage%; background: rgba(255,255,255,0.8);"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Overall Progress -->
            <div class="col-md-3 slide-in-right" style="animation-delay: 0.3s;">
                <div class="stat-card-modern" style="background: var(--gradient-accent);">
                    <div style="color: white;">
                        <div style="font-size: 0.9rem; margin-bottom: 1.5rem; opacity: 0.9;">OVERALL PROGRESS</div>
                        @{
                            var totalProgress = Model.StrategicGoals?.SelectMany(g => g.Metrics ?? new List<GoalMetric>()).Any() == true
                                ? Model.StrategicGoals.SelectMany(g => g.Metrics ?? new List<GoalMetric>()).Average(m => m.ProgressPercentage) 
                                : 0;
                        }
                        <h2 style="color: white; margin-bottom: 1rem; font-weight: 700;">@Math.Round(totalProgress, 1)%</h2>
                        <small style="opacity: 0.8;">Strategic Plan Progress</small>
                        <div class="progress-modern mt-3" style="background: rgba(255,255,255,0.2);">
                            <div class="progress-bar" style="width: @Math.Min(totalProgress, 100)%; background: rgba(255,255,255,0.8);"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Enhanced Footer Information -->
        <div class="row mt-6 fade-in">
            <div class="col-12">
                <div class="floating-card" style="background: var(--gradient-primary); color: white;">
                    <div class="card-body text-center" style="padding: 3rem;">
                        <div class="row align-items-center">
                            <div class="col-md-8">
                                <h5 style="color: white; margin-bottom: 1rem; font-weight: 600;">
                                    Questions or feedback about this dashboard?
                                </h5>
                                <p style="color: rgba(255,255,255,0.9); margin-bottom: 0; font-size: 1.1rem;">
                                    Email us at <a href="mailto:onejax@onejax.org" style="color: var(--onejax-orange); text-decoration: none; font-weight: 600;">onejax@onejax.org</a>
                                </p>
                            </div>
                            <div class="col-md-4 text-end">
                                <div style="background: rgba(255,255,255,0.1); border-radius: 15px; padding: 1.5rem; backdrop-filter: blur(10px);">
                                    <div style="font-size: 0.9rem; opacity: 0.8; margin-bottom: 0.5rem;">LAST UPDATED</div>
                                    <div style="font-weight: 600; font-size: 1.1rem;">@DateTime.Now.ToString("MMM dd, yyyy")</div>
                                    <div style="margin-top: 1rem;">
                                        <a href="#" style="color: white; text-decoration: none; font-size: 0.9rem;" onclick="showComingSoon('Mobile App')">
                                            Mobile App
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row mt-4">
                            <div class="col-12">
                                <div style="height: 1px; background: rgba(255,255,255,0.2); margin: 1rem 0;"></div>
                                <p style="color: rgba(255,255,255,0.7); margin-bottom: 0; font-size: 0.9rem;">
                                    OneJax Strategic Dashboard | Fiscal Year 2025 | 
                                    Secure & Confidential | 
                                    Real-time Data Analytics
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Event Details Modal -->
<div class="modal fade" id="eventDetailsModal" tabindex="-1" aria-labelledby="eventDetailsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content" style="border-radius: 16px; border: none; overflow: hidden;">
            <div class="modal-header" style="background: linear-gradient(135deg, var(--onejax-navy), var(--onejax-blue)); color: white; border: none; padding: 2rem;">
                <h5 class="modal-title" id="eventDetailsModalLabel" style="font-weight: 700; font-size: 1.5rem;">Event Details</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="eventDetailsContent" style="padding: 2rem;">
                <div class="text-center">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <p class="mt-3 text-muted">Loading event details...</p>
                </div>
            </div>
            <div class="modal-footer" style="border: none; padding: 1rem 2rem 2rem;">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" style="border-radius: 8px;">Close</button>
                @if (User?.Identity?.IsAuthenticated ?? false)
                {
                    <a id="editEventButton" href="/Strategy/ViewEvents" class="btn btn-primary" target="_blank" style="border-radius: 8px; background: var(--onejax-blue); border-color: var(--onejax-blue);">
                        <i class="fas fa-cog"></i> Manage in Core Strategies
                    </a>
                }
            </div>
        </div>
    </div>
</div>

<!-- Chart.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>

<!-- OneJax Dashboard Scripts -->
<script src="~/js/dashboard-charts.js"></script>
<script src="~/js/dashboard-interactions.js"></script>

<!-- Dashboard Data Setup -->
<script>
    // Set up data for external JavaScript files
    window.chartData = {
        goalProgress: [@Model.Charts.GoalProgress.OrganizationalProgress, @Model.Charts.GoalProgress.FinancialProgress, @Model.Charts.GoalProgress.IdentityProgress, @Model.Charts.GoalProgress.CommunityProgress],
        activitySummary: [@Model.Summary.TotalStaffSurveys, @Model.Summary.TotalProfessionalDevelopmentPlans, @Model.Summary.TotalMediaPlacements, @Model.Summary.TotalWebsiteTrafficEntries, @Model.Summary.TotalEvents],
        monthlyTrends: {
            labels: [@Html.Raw(string.Join(",", Model.Charts.MonthlyTrends.Select(t => $"'{t.Month}'")))],
            organizational: [@Html.Raw(string.Join(",", Model.Charts.MonthlyTrends.Select(t => t.OrganizationalValue.ToString())))],
            community: [@Html.Raw(string.Join(",", Model.Charts.MonthlyTrends.Select(t => t.CommunityValue.ToString())))],
            financial: [@Html.Raw(string.Join(",", Model.Charts.MonthlyTrends.Select(t => t.FinancialValue.ToString())))],
            identity: [@Html.Raw(string.Join(",", Model.Charts.MonthlyTrends.Select(t => t.IdentityValue.ToString())))],
        },
        metricTypes: {
            labels: [@Html.Raw(string.Join(",", Model.Charts.MetricTypes.Select(mt => $"'{mt.Type}'")))],
            values: [@Html.Raw(string.Join(",", Model.Charts.MetricTypes.Select(mt => mt.Count.ToString())))]
        },
        radarCurrent: [@Model.Charts.GoalProgress.OrganizationalProgress, @Model.Charts.GoalProgress.FinancialProgress, @Model.Charts.GoalProgress.IdentityProgress, @Model.Charts.GoalProgress.CommunityProgress, @((Model.Summary.AverageStaffSatisfaction > 0 ? Model.Summary.AverageStaffSatisfaction : 0)), @((Model.Summary.TotalWebsiteTrafficEntries > 0 ? Math.Min(Model.Summary.TotalWebsiteTrafficEntries * 10, 100) : 0))],
        quarterly: {
            labels: [@Html.Raw(string.Join(",", Model.Charts.QuarterlyData.Select(q => $"'{q.Quarter}'")))],
            values: [@Html.Raw(string.Join(",", Model.Charts.QuarterlyData.Select(q => q.Value.ToString())))]
        }
    };

    window.summaryData = {
        totalStaffSurveys: @Model.Summary.TotalStaffSurveys,
        totalProfessionalDevelopmentPlans: @Model.Summary.TotalProfessionalDevelopmentPlans,
        totalMediaPlacements: @Model.Summary.TotalMediaPlacements,
        totalWebsiteTrafficEntries: @Model.Summary.TotalWebsiteTrafficEntries,
        totalEvents: @Model.Summary.TotalEvents,
        totalActivities: @Model.Summary.TotalActivities
    };

    window.userAuthenticated = @((User.Identity?.IsAuthenticated ?? false).ToString().ToLower());
</script>

<script>
// Apply Filters Function (No Page Refresh)
function applyFilters() {
    const statusFilter = document.getElementById('statusFilter').value;
    const timeFilter = document.getElementById('timeFilter').value;
    const fiscalYearFilter = document.getElementById('fiscalYearFilter').value;
    const quarterFilter = document.getElementById('quarterFilter').value;
    
    // Build query parameters for URL
    const params = new URLSearchParams();
    if (statusFilter) params.set('status', statusFilter);
    if (timeFilter) params.set('time', timeFilter);
    if (fiscalYearFilter) params.set('fiscalYear', fiscalYearFilter);
    if (quarterFilter) params.set('quarter', quarterFilter);
    
    // Redirect to apply server-side filtering
    const newUrl = params.toString() ? 
        `${window.location.pathname}?${params.toString()}` : 
        window.location.pathname;
    
    // Show loading notification
    let filterText = [];
    if (statusFilter) filterText.push(`Status: ${statusFilter}`);
    if (fiscalYearFilter) filterText.push(`Fiscal Year: ${fiscalYearFilter}`);
    if (quarterFilter) filterText.push(`Quarter: ${quarterFilter}`);
    if (timeFilter) filterText.push(`Legacy Time: ${timeFilter}`);
    
    const filterDescription = filterText.length > 0 ? filterText.join(', ') : 'All items';
    showNotification('Applying Filters', `Filtering by: ${filterDescription}`, 'info');
    
    // Navigate to the new URL with filters
    window.location.href = newUrl;
}

function showComingSoon(feature) {
    showNotification(feature + ' Coming Soon!', 'This exciting feature is currently in development and will be available in the next update.', 'info');
}

// Reset Filters Function
function resetFilters() {
    // Reset the select elements to their default values
    const statusFilter = document.getElementById('statusFilter');
    const timeFilter = document.getElementById('timeFilter');
    const fiscalYearFilter = document.getElementById('fiscalYearFilter');
    const quarterFilter = document.getElementById('quarterFilter');
    
    if (statusFilter) {
        statusFilter.value = '';
    }
    if (timeFilter) {
        timeFilter.value = '';
    }
    if (fiscalYearFilter) {
        fiscalYearFilter.value = '';
    }
    if (quarterFilter) {
        quarterFilter.value = '';
    }
    
    // Show notification and redirect to clear URL
    showNotification('Filters Reset', 'All filters have been cleared. Showing all projects.', 'info');
    
    // Navigate to the base URL without any filters
    window.location.href = window.location.pathname;
}

// Enhanced Notification System
function showNotification(title, message, type = 'info') {
    const notification = document.createElement('div');
    notification.className = `alert alert-${type} floating-notification`;
    notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 9999;
        min-width: 350px;
        border-radius: 15px;
        box-shadow: var(--shadow-strong);
        backdrop-filter: blur(10px);
        border: none;
        animation: slideInRight 0.5s ease-out;
    `;
    notification.innerHTML = `
        <div style="display: flex; align-items: center; gap: 12px;">
            <div style="font-weight: 700; color: var(--onejax-navy);">${title}</div>
            <button type="button" class="btn-close" onclick="this.parentElement.parentElement.remove()"></button>
        </div>
        <div style="margin-top: 8px; color: var(--onejax-text-muted);">${message}</div>
    `;
    
    document.body.appendChild(notification);
    
    setTimeout(() => {
        if (notification.parentNode) {
            notification.style.animation = 'slideOutRight 0.5s ease-in';
            setTimeout(() => notification.remove(), 500);
        }
    }, 4000);
}

// Tab Switching Function (No Page Refresh)
function switchTab(goalName, clickedTab) {
    console.log('Switching to tab:', goalName); // Debug log
    
    // Prevent any default behavior
    if (event) {
        event.preventDefault();
        event.stopPropagation();
    }
    
    // Update active tab - make sure tabs remain visible
    const allTabs = document.querySelectorAll('.nav-tabs-modern .nav-link');
    console.log('Found tabs:', allTabs.length); // Debug log
    
    allTabs.forEach(tab => {
        tab.classList.remove('active');
        // Ensure tabs remain visible
        tab.style.display = 'block';
        tab.style.visibility = 'visible';
        tab.style.opacity = '1';
    });
    
    // Ensure the nav tabs container remains visible
    const navContainer = document.querySelector('.nav-tabs-modern');
    if (navContainer) {
        navContainer.style.display = 'flex';
        navContainer.style.visibility = 'visible';
        navContainer.style.opacity = '1';
    }
    
    if (clickedTab) {
        clickedTab.classList.add('active');
    } else {
        // Find the tab by data attribute
        const targetTab = document.querySelector(`.nav-link[data-tab="${goalName}"]`);
        if (targetTab) {
            targetTab.classList.add('active');
        }
    }
    
    // Hide all goal sections
    const allSections = document.querySelectorAll('.goal-section');
    allSections.forEach(section => {
        section.style.display = 'none';
        section.style.opacity = '0';
    });
    
    // Show the selected section with animation
    const targetSection = document.querySelector(`.goal-section[data-goal="${goalName}"]`);
    if (targetSection) {
        targetSection.style.display = 'block';
        
        // Trigger fade-in animation
        setTimeout(() => {
            targetSection.style.opacity = '1';
            targetSection.style.transition = 'opacity 0.3s ease-in-out';
        }, 50);
        
        // Re-initialize progress bar animations for the new content
        if (typeof initializeProgressBars === 'function') {
            initializeProgressBars(targetSection);
        }
    }
    
    // Update URL without refresh (optional - for bookmarking)
    const newUrl = goalName === 'summary' ? 
        window.location.pathname : 
        `${window.location.pathname}?goal=${goalName.replace('_', ' ')}`;
    window.history.replaceState(null, '', newUrl);
}

// Initialize progress bars for a specific section
function initializeProgressBars(container) {
    const progressBars = container.querySelectorAll('.progress-bar');
    progressBars.forEach(bar => {
        const targetWidth = bar.style.width;
        bar.style.width = '0%';
        bar.style.transition = 'none';
        
        setTimeout(() => {
            bar.style.transition = 'width 1s cubic-bezier(0.4, 0, 0.2, 1)';
            bar.style.width = targetWidth;
        }, 100);
    });
}

// Quick Edit Metric Function - Staff/Admin Only
function editMetric(metricId) {
    // Check if user is authenticated (simple client-side check)
    var isAuthenticated = '@((User.Identity?.IsAuthenticated ?? false).ToString().ToLower())' === 'true';
    
    if (!isAuthenticated) {
        showNotification('Access Denied', 'Please log in as staff/admin to edit metrics', 'error');
        return;
    }
    
    // Create a modal or inline edit interface
    const currentValue = prompt('Enter new value for this metric (Staff Only):');
    
    if (currentValue !== null && currentValue !== '') {
        // Send AJAX request to update the metric
        fetch('/DashboardMetrics/QuickUpdate', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'RequestVerificationToken': document.querySelector('input[name="__RequestVerificationToken"]')?.value || ''
            },
            body: JSON.stringify({
                metricId: metricId,
                currentValue: parseFloat(currentValue) || 0
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Refresh the current tab to show updated values
                location.reload();
                showNotification('Metric Updated', 'The metric value has been successfully updated', 'success');
            } else {
                if (data.message.includes('Authentication')) {
                    showNotification('Access Denied', 'Please log in as staff/admin to edit metrics', 'error');
                } else {
                    showNotification('Error', 'Failed to update metric: ' + data.message, 'error');
                }
            }
        })
        .catch(error => {
            console.error('Error:', error);
            showNotification('Error', 'Failed to update metric. Please check your connection and authentication.', 'error');
        });
    }
}

// Enhanced Interactive Features
document.addEventListener('DOMContentLoaded', function() {
    // Initialize charts first
    initializeDashboardCharts();
    
    // Initialize animations and interactions
    initializeAnimations();
    
    // Add enhanced hover effects
    const interactiveElements = document.querySelectorAll('.floating-card, .stat-card-modern, .metric-card');
    interactiveElements.forEach(element => {
        element.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-8px) scale(1.02)';
            this.style.transition = 'all 0.3s cubic-bezier(0.4, 0, 0.2, 1)';
        });
        
        element.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0) scale(1)';
        });
    });
    
    // Add click animations to buttons (excluding nav-links with onclick handlers)
    const buttons = document.querySelectorAll('.btn-modern');
    buttons.forEach(button => {
        button.addEventListener('click', function(e) {
            const ripple = document.createElement('span');
            const rect = this.getBoundingClientRect();
            const size = Math.max(rect.width, rect.height);
            const x = e.clientX - rect.left - size / 2;
            const y = e.clientY - rect.top - size / 2;
            
            ripple.style.cssText = `
                position: absolute;
                width: ${size}px;
                height: ${size}px;
                left: ${x}px;
                top: ${y}px;
                background: rgba(255, 255, 255, 0.4);
                border-radius: 50%;
                transform: scale(0);
                animation: ripple 0.6s ease-out;
                pointer-events: none;
            `;
            
            this.style.position = 'relative';
            this.style.overflow = 'hidden';
            this.appendChild(ripple);
            
            setTimeout(() => ripple.remove(), 600);
        });
    });
    
    // Add real-time filtering on dropdown change
    const statusFilter = document.getElementById('statusFilter');
    const timeFilter = document.getElementById('timeFilter');
    
    // Removed automatic filter application - now filters only apply when button is clicked
    // if (statusFilter) {
    //     statusFilter.addEventListener('change', applyFilters);
    // }
    // if (timeFilter) {
    //     timeFilter.addEventListener('change', applyFilters);
    // }
    
    // Auto-refresh with visual indicator
    setInterval(() => {
        showDataRefresh();
    }, 60000); // Every minute
});

// Enhanced Progress Bar Animation
function initializeAnimations() {
    const progressBars = document.querySelectorAll('.progress-bar');
    const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
    };
    
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                const progressBar = entry.target;
                const targetWidth = progressBar.style.width;
                progressBar.style.width = '0%';
                
                setTimeout(() => {
                    progressBar.style.width = targetWidth;
                    progressBar.style.transition = 'width 2s cubic-bezier(0.4, 0, 0.2, 1)';
                }, 200);
                
                observer.unobserve(progressBar);
            }
        });
    }, observerOptions);
    
    progressBars.forEach(bar => observer.observe(bar));
}

function showDataRefresh() {
    const refreshIndicator = document.createElement('div');
    refreshIndicator.style.cssText = `
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: var(--gradient-secondary);
        color: white;
        padding: 12px 20px;
        border-radius: 25px;
        font-size: 0.9rem;
        font-weight: 600;
        box-shadow: var(--shadow-medium);
        z-index: 9999;
        animation: fadeIn 0.5s ease-out;
    `;
    refreshIndicator.innerHTML = 'Data refreshed â€¢ ' + new Date().toLocaleTimeString();
    
    document.body.appendChild(refreshIndicator);
    
    setTimeout(() => {
        refreshIndicator.style.animation = 'fadeOut 0.5s ease-in';
        setTimeout(() => refreshIndicator.remove(), 500);
    }, 3000);
}

// Add CSS animations for notifications
const style = document.createElement('style');
style.textContent = `
    /* Fade-in animations for tabs and elements */
    .fade-in {
        animation: fadeIn 0.6s ease-out forwards;
        opacity: 0;
    }
    
    .slide-in-left {
        animation: slideInLeft 0.8s ease-out forwards;
        opacity: 0;
    }
    
    .slide-in-right {
        animation: slideInRight 0.8s ease-out forwards;
        opacity: 0;
    }
    
    .pulse-animation {
        animation: pulse 2s ease-in-out infinite;
    }
    
    /* Navigation tabs specific styles */
    .nav-tabs-modern {
        opacity: 1 !important;
        visibility: visible !important;
        display: flex !important;
    }
    
    .nav-tabs-modern .nav-link {
        opacity: 1 !important;
        visibility: visible !important;
        display: block !important;
    }
    
    @@keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    @@keyframes slideInLeft {
        from { opacity: 0; transform: translateX(-50px); }
        to { opacity: 1; transform: translateX(0); }
    }

    @@keyframes slideInRight {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
    }
    
    @@keyframes slideOutRight {
        from { transform: translateX(0); opacity: 1; }
        to { transform: translateX(100%); opacity: 0; }
    }
    
    @@keyframes pulse {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.05); }
    }
    
    @@keyframes ripple {
        to { transform: scale(4); opacity: 0; }
    }
    
    @@keyframes fadeOut {
        from { opacity: 1; }
        to { opacity: 0; }
    }
`;
document.head.appendChild(style);

// Welcome message
setTimeout(() => {
    showNotification('Welcome to OneJax Dashboard', 'Explore your strategic initiatives with enhanced visuals and interactive features!', 'info');
}, 1000);

// Dashboard Charts Setup
function initializeDashboardCharts() {
    // Goal Progress Chart (Doughnut)
    const progressCtx = document.getElementById('progressChart');
    if (progressCtx) {
        const progressChart = new Chart(progressCtx, {
            type: 'doughnut',
            data: {
                labels: ['Organizational Building', 'Financial Sustainability', 'Identity/Value Prop', 'Community Engagement'],
                datasets: [{
                    data: [@Model.Charts.GoalProgress.OrganizationalProgress, @Model.Charts.GoalProgress.FinancialProgress, @Model.Charts.GoalProgress.IdentityProgress, @Model.Charts.GoalProgress.CommunityProgress],
                    backgroundColor: ['#1e3a8a', '#10b981', '#f59e0b', '#3b82f6'],
                    borderWidth: 3,
                    borderColor: '#fff'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            padding: 15,
                            usePointStyle: true
                        }
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return context.label + ': ' + Math.round(context.raw) + '% complete';
                            }
                        }
                    }
                }
            }
        });
    }

    // Activity Summary Chart (Bar)
    const activityCtx = document.getElementById('activityChart');
    if (activityCtx) {
        const activityChart = new Chart(activityCtx, {
            type: 'bar',
            data: {
                labels: ['Staff Surveys', 'Prof. Development', 'Media Placements', 'Website Traffic', 'Events'],
                datasets: [{
                    label: 'Count',
                    data: [@Model.Summary.TotalStaffSurveys, @Model.Summary.TotalProfessionalDevelopmentPlans, @Model.Summary.TotalMediaPlacements, @Model.Summary.TotalWebsiteTrafficEntries, @Model.Summary.TotalEvents],
                    backgroundColor: ['#1e3a8a', '#10b981', '#f59e0b', '#3b82f6', '#8b5cf6'],
                    borderRadius: 4,
                    borderSkipped: false,
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    }
                }
            }
        });
    }
    
    // Monthly Trends Chart (Line)
    const trendsCtx = document.getElementById('trendsChart');
    if (trendsCtx) {
        const trendsChart = new Chart(trendsCtx, {
            type: 'line',
            data: {
                labels: [@Html.Raw(string.Join(",", Model.Charts.MonthlyTrends.Select(t => $"'{t.Month}'")))],
                datasets: [
                    {
                        label: 'Organizational Building',
                        data: [@Html.Raw(string.Join(",", Model.Charts.MonthlyTrends.Select(t => t.OrganizationalValue.ToString())))],
                        borderColor: '#1e3a8a',
                        backgroundColor: 'rgba(30, 58, 138, 0.1)',
                        tension: 0.4,
                        fill: false
                    },
                    {
                        label: 'Community Engagement',
                        data: [@Html.Raw(string.Join(",", Model.Charts.MonthlyTrends.Select(t => t.CommunityValue.ToString())))],
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        tension: 0.4,
                        fill: false
                    },
                    {
                        label: 'Financial Sustainability',
                        data: [@Html.Raw(string.Join(",", Model.Charts.MonthlyTrends.Select(t => t.FinancialValue.ToString())))],
                        borderColor: '#f59e0b',
                        backgroundColor: 'rgba(245, 158, 11, 0.1)',
                        tension: 0.4,
                        fill: false
                    },
                    {
                        label: 'Identity/Value Prop',
                        data: [@Html.Raw(string.Join(",", Model.Charts.MonthlyTrends.Select(t => t.IdentityValue.ToString())))],
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        tension: 0.4,
                        fill: false
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top'
                    },
                    tooltip: {
                        mode: 'index',
                        intersect: false,
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true
                    }
                },
                interaction: {
                    mode: 'nearest',
                    axis: 'x',
                    intersect: false
                }
            }
        });
    }
    
    // Metrics Type Distribution Chart (Pie)
    const metricsTypeCtx = document.getElementById('metricsTypeChart');
    if (metricsTypeCtx) {
        const metricsTypeChart = new Chart(metricsTypeCtx, {
            type: 'pie',
            data: {
                labels: [@Html.Raw(string.Join(",", Model.Charts.MetricTypes.Select(mt => $"'{mt.Type}'")))],
                datasets: [{
                    data: [@Html.Raw(string.Join(",", Model.Charts.MetricTypes.Select(mt => mt.Count.ToString())))],
                    backgroundColor: ['#ef4444', '#64748b', '#10b981', '#8b5cf6', '#f59e0b', '#06b6d4'],
                    borderWidth: 2,
                    borderColor: '#fff'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            padding: 10,
                            usePointStyle: true
                        }
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return context.label + ': ' + context.raw + ' metrics';
                            }
                        }
                    }
                }
            }
        });
    }
    
    // Goal Performance Radar Chart
    const radarCtx = document.getElementById('radarChart');
    if (radarCtx) {
        const radarChart = new Chart(radarCtx, {
            type: 'radar',
            data: {
                labels: ['Organizational', 'Financial', 'Identity/Value', 'Community', 'Staff Satisfaction', 'Public Engagement'],
                datasets: [{
                    label: 'Current Performance',
                    data: [@Model.Charts.GoalProgress.OrganizationalProgress, @Model.Charts.GoalProgress.FinancialProgress, @Model.Charts.GoalProgress.IdentityProgress, @Model.Charts.GoalProgress.CommunityProgress, @((Model.Summary.AverageStaffSatisfaction > 0 ? Model.Summary.AverageStaffSatisfaction : 0)), @((Model.Summary.TotalWebsiteTrafficEntries > 0 ? Math.Min(Model.Summary.TotalWebsiteTrafficEntries * 10, 100) : 0))],
                    borderColor: '#3b82f6',
                    backgroundColor: 'rgba(59, 130, 246, 0.2)',
                    borderWidth: 2,
                    pointBackgroundColor: '#3b82f6',
                    pointBorderColor: '#fff',
                    pointHoverBackgroundColor: '#fff',
                    pointHoverBorderColor: '#3b82f6'
                }, {
                    label: 'Target Performance',
                    data: [85, 80, 75, 90, 85, 70],
                    borderColor: '#10b981',
                    backgroundColor: 'rgba(16, 185, 129, 0.1)',
                    borderWidth: 2,
                    borderDash: [5, 5],
                    pointBackgroundColor: '#10b981',
                    pointBorderColor: '#fff'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top'
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return context.dataset.label + ': ' + Math.round(context.raw) + '%';
                            }
                        }
                    }
                },
                scales: {
                    r: {
                        beginAtZero: true,
                        max: 100
                    }
                }
            }
        });
    }
}
    
    /*
    // Financial Metrics Area Chart (Temporarily disabled for debugging)
    const financialCtx = document.getElementById('financialChart');
    if (financialCtx) {        
        @{
            // Use your known financial values directly for now
            var totalRevenue = 7540m; // Your actual revenue
            var totalExpenses = 6000m; // Estimated expenses
            
            // Distribute across fiscal year quarters
            var q1Revenue = Math.Round(totalRevenue * 0.20m, 0);
            var q2Revenue = Math.Round(totalRevenue * 0.25m, 0);
            var q3Revenue = Math.Round(totalRevenue * 0.30m, 0);
            var q4Revenue = Math.Round(totalRevenue * 0.25m, 0);
            
            var q1Expense = Math.Round(totalExpenses * 0.20m, 0);
            var q2Expense = Math.Round(totalExpenses * 0.25m, 0);
            var q3Expense = Math.Round(totalExpenses * 0.30m, 0);
            var q4Expense = Math.Round(totalExpenses * 0.25m, 0);
        }
        
        const financialChart = new Chart(financialCtx, {
            type: 'line',
            data: {
                labels: ['Q1 (Jul-Sep)', 'Q2 (Oct-Dec)', 'Q3 (Jan-Mar)', 'Q4 (Apr-Jun)'],
                datasets: [{
                    label: 'Revenue ($)',
                    data: [@q1Revenue, @q2Revenue, @q3Revenue, @q4Revenue],
                    borderColor: '#10b981',
                    backgroundColor: 'rgba(16, 185, 129, 0.3)',
                    fill: true,
                    tension: 0.4
                }, {
                    label: 'Expenses ($)',
                    data: [@q1Expense, @q2Expense, @q3Expense, @q4Expense],
                    borderColor: '#ef4444',
                    backgroundColor: 'rgba(239, 68, 68, 0.3)',
                    fill: true,
                    tension: 0.4
                }, {
                    label: 'Net Income ($)',
                    data: [@(q1Revenue - q1Expense), @(q2Revenue - q2Expense), @(q3Revenue - q3Expense), @(q4Revenue - q4Expense)],
                    borderColor: '#f59e0b',
                    backgroundColor: 'rgba(245, 158, 11, 0.3)',
                    fill: true,
                    tension: 0.4
                }]
            },
            options: {
                responsive: false,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top',
                        labels: {
                            boxWidth: 12,
                            font: {
                                size: 11
                            }
                        }
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return context.dataset.label + ': $' + context.raw.toLocaleString();
                            }
                        }
                    }
                },
                scales: {
                    x: {
                        ticks: {
                            font: {
                                size: 10
                            }
                        }
                    },
                    y: {
                        beginAtZero: true,
                        ticks: {
                            font: {
                                size: 10
                            },
                            callback: function(value) {
                                if (value >= 1000) {
                                    return '$' + (value/1000).toFixed(0) + 'K';
                                }
                                return '$' + value.toFixed(0);
                            }
                        }
                    }
                }
            }
        });
    }
    */
    
    // Quarterly Performance Chart (Horizontal Bar)
    const quarterlyCtx = document.getElementById('quarterlyChart');
    if (quarterlyCtx) {
        const quarterlyChart = new Chart(quarterlyCtx, {
            type: 'bar',
            data: {
                labels: [@Html.Raw(string.Join(",", Model.Charts.QuarterlyData.Select(q => $"'{q.Quarter}'")))],
                datasets: [
                    {
                        label: 'Website Traffic (Primary Metric)',
                        data: [@Html.Raw(string.Join(",", Model.Charts.QuarterlyData.Select(q => q.Value.ToString())))],
                        backgroundColor: ['#1e3a8a', '#10b981', '#f59e0b', '#3b82f6'],
                        borderWidth: 1,
                        borderColor: '#fff'
                    }
                ]
            },
            plugins: [ChartDataLabels],
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: true,
                        position: 'top'
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return context.dataset.label + ': ' + context.raw.toLocaleString() + ' clicks';
                            }
                        }
                    },
                    datalabels: {
                        anchor: 'end',
                        align: 'top',
                        offset: 5,
                        formatter: function(value, context) {
                            return value.toLocaleString() + ' clicks';
                        },
                        color: '#1f2937',
                        font: {
                            weight: 'bold',
                            size: 12
                        },
                        backgroundColor: 'rgba(255, 255, 255, 0.9)',
                        borderColor: '#d1d5db',
                        borderWidth: 1,
                        borderRadius: 4,
                        padding: 4
                    }
                },
                scales: {
                    x: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Fiscal Year Quarters'
                        }
                    },
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Website Traffic (Clicks)'
                        }
                    }
                }
            }
        });
    }
}

// Export Dashboard Function
function exportDashboard() {
    const dashboardData = {
        summary: {
            totalStaffSurveys: @Model.Summary.TotalStaffSurveys,
            totalProfessionalDevelopmentPlans: @Model.Summary.TotalProfessionalDevelopmentPlans,
            totalMediaPlacements: @Model.Summary.TotalMediaPlacements,
            totalWebsiteTrafficEntries: @Model.Summary.TotalWebsiteTrafficEntries,
            totalEvents: @Model.Summary.TotalEvents,
            totalActivities: @Model.Summary.TotalActivities
        },
        exportDate: new Date().toISOString(),
        source: '@Model.DataSource'
    };
    
    const dataStr = JSON.stringify(dashboardData, null, 2);
    const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
    
    const exportFileName = `OneJax_Dashboard_${new Date().toISOString().split('T')[0]}.json`;
    
    const linkElement = document.createElement('a');
    linkElement.setAttribute('href', dataUri);
    linkElement.setAttribute('download', exportFileName);
    linkElement.click();
}

// Load Event Details into Modal
function loadEventDetails(eventId) {
    // Check if user is authenticated
    var isAuthenticated = @((User?.Identity?.IsAuthenticated ?? false).ToString().ToLower());
    
    if (!isAuthenticated) {
        alert('Please log in to view event details.');
        return;
    }
    
    console.log('Loading event details for ID:', eventId);
    
    // Update modal title and show minimal loading state
    const modalLabel = document.getElementById('eventDetailsModalLabel');
    const modalContent = document.getElementById('eventDetailsContent');
    
    modalLabel.textContent = 'Loading...';
    modalContent.innerHTML = '<div class="text-center p-4"><div class="spinner-border text-primary"></div><p class="mt-2">Loading event details...</p></div>';
    
    // Update edit button to link to Core Strategies View Events page
    const editButton = document.getElementById('editEventButton');
    editButton.href = '/Strategy/ViewEvents';
    console.log('Edit button href set to Core Strategies View Events:', editButton.href);
    
    // Test the API endpoint with detailed logging
    console.log('Fetching from:', '/Events/Api/Details/' + eventId);
    
    fetch('/Events/Api/Details/' + eventId)
        .then(response => {
            console.log('Response status:', response.status);
            console.log('Response ok:', response.ok);
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            console.log('Received data:', data);
            
            if (data.error) {
                throw new Error(data.error);
            }
            
            // Update modal with simple content first
            modalLabel.textContent = data.Title || 'Event Details';
            modalContent.innerHTML = `
                <div class="card">
                    <div class="card-body">
                        <h5>Event Information</h5>
                        <p><strong>Title:</strong> ${data.Title}</p>
                        <p><strong>Type:</strong> ${data.Type}</p>
                        <p><strong>Status:</strong> ${data.Status}</p>
                        <p><strong>Date:</strong> ${data.DueDate}</p>
                        <p><strong>Location:</strong> ${data.Location}</p>
                        <p><strong>Description:</strong> ${data.Description || 'No description'}</p>
                        <p><strong>Notes:</strong> ${data.Notes || 'No notes'}</p>
                        <p><strong>Goal:</strong> ${data.GoalName}</p>
                        <p><strong>Source:</strong> ${data.Source}</p>
                    </div>
                </div>
            `;
            
            console.log('Modal content updated successfully');
        })
        .catch(error => {
            console.error('Error details:', error);
            modalLabel.textContent = 'Error Loading Event';
            modalContent.innerHTML = `
                <div class="alert alert-danger">
                    <h5>Error loading event details</h5>
                    <p><strong>Error:</strong> ${error.message}</p>
                    <p><strong>Event ID:</strong> ${eventId}</p>
                    <p>Please check the browser console for more details.</p>
                    <hr>
                    <a href="/Events/Details/${eventId}" class="btn btn-primary" target="_blank">
                        Open Full Details Page
                    </a>
                </div>
            `;
        });
}
                                    <div class="col-md-6 mb-3">
                                        <h6 style="color:var(--onejax-text);font-weight:600">Strategic Goal</h6>
                                        <p style="color:var(--onejax-text-muted);margin:0">${data.GoalName}</p>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <h6 style="color:var(--onejax-text);font-weight:600">Expected Attendees</h6>
                                        <p style="color:var(--onejax-text-muted);margin:0">${data.Attendees || 'Not specified'}</p>
                                    </div>
                                </div>
                                
                                ${data.Description ? `
                                    <div class="mt-4">
                                        <h6 style="color:var(--onejax-text);font-weight:600">Description</h6>
                                        <p style="color:var(--onejax-text-muted);line-height:1.6">${data.Description}</p>
                                    </div>
                                ` : ''}
                                
                                ${data.Notes ? `
                                    <div class="mt-4">
                                        <h6 style="color:var(--onejax-text);font-weight:600">Notes</h6>
                                        <p style="color:var(--onejax-text-muted);line-height:1.6">${data.Notes}</p>
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-lg-4">
                        ${data.SatisfactionScore ? `
                            <div class="card mb-4" style="border:none;box-shadow:0 4px 20px rgba(0,0,0,0.08)">
                                <div class="card-body text-center p-4">
                                    <h5 style="color:var(--onejax-navy);margin-bottom:1.5rem">Satisfaction Score</h5>
                                    <div style="font-size:2.5rem;font-weight:700;color:var(--onejax-green);margin-bottom:0.5rem">
                                        ${data.SatisfactionScore.toFixed(1)}
                                    </div>
                                    <small style="color:var(--onejax-text-muted)">Out of 5.0</small>
                                </div>
                            </div>
                        ` : ''}
                        
                        <div class="card" style="border:none;box-shadow:0 4px 20px rgba(0,0,0,0.08)">
                            <div class="card-body p-4">
                                <h5 style="color:var(--onejax-navy);margin-bottom:1.5rem">Event Source</h5>
                                <p style="color:var(--onejax-text-muted);margin:0">
                                    ${data.Source === 'Database' ? 
                                        '<i class="fas fa-database text-primary"></i> Database Event' : 
                                        '<i class="fas fa-lightbulb text-warning"></i> Core Strategy Event'
                                    }
                                </p>
                                <small style="color:var(--onejax-text-muted);font-size:0.85rem">
                                    ${data.Source === 'Database' ? 
                                        'This event was added through the Events management system.' : 
                                        'This event was added through the Core Strategies tab.'
                                    }
                                </small>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        })
        .catch(error => {
            console.error('Error loading event details:', error);
            modalLabel.textContent = 'Error Loading Event';
            modalContent.innerHTML = `
                <div class="alert alert-danger">
                    <i class="fas fa-exclamation-circle"></i>
                    <strong>Error loading event details.</strong><br>
                    ${error.message || 'Please try again later.'}
                    <br><br>
                    <a href="/Events/Details/${eventId}" class="btn btn-primary">
                        <i class="fas fa-external-link-alt"></i> View Full Details Page
                    </a>
                </div>
            `;
        });
}
</script>

@{
    string GetEventHeaderColor(string status)
    {
        return status switch
        {
            "Completed" => "#10b981",
            "Active" => "#3b82f6",
            "In Progress" => "#f59e0b",
            "Planned" => "#6b7280",
            _ => "#374151"
        };
    }

    string GetEventHeaderColorSecondary(string status)
    {
        return status switch
        {
            "Completed" => "#059669",
            "Active" => "#2563eb",
            "In Progress" => "#d97706",
            "Planned" => "#4b5563",
            _ => "#1f2937"
        };
    }
}